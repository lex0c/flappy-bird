function stateGame(){currentState==states.duringGame?playerJump():currentState==states.splashScreen&&startGame()}function startGame(){currentState=states.duringGame,$("#splash-screen").stop(),$("#splash-screen").transition({opacity:0},500,"ease"),setScoreInGame(),debugMode&&$(".boundingbox").show(),gameLoop=setInterval(inLoop,15),obstacleLoop=setInterval(addObstacle,1400),playerJump()}function inLoop(){velocity+=gravity,position+=velocity,updatePlayer($("#player"));var a=document.getElementById("player").getBoundingClientRect(),b=34,c=24,d=b-8*Math.sin(Math.abs(rotation)/90),e=(c+a.height)/2,f=(a.height-e)/2+a.top,g=(a.width-d)/2+a.left,h=g+d,i=f+e;if(a.bottom>=$("#land").offset().top)return void playerDead();if(f<=$("#ceiling").offset().top+$("#ceiling").height())position=0;else if(null==obstacle[0])return;var j=obstacle[0],k=j.children(".obstacle_upper"),l=k.offset().top+k.height(),m=k.offset().left-2,n=m+obstacleWidth,o=l+obstacleHeight;return h>m&&!(f>l&&i<o)?void playerDead():void(g>n&&(obstacle.splice(0,1),updateScore()))}function playerJump(){velocity=-4.5,soundJump.stop(),soundJump.play()}function playerDead(){$(".animated").css("-webkit-animation-play-state","paused"),$(".animated").css("-moz-animation-play-state","paused"),$(".animated").css("-o-animation-play-state","paused"),$(".animated").css("animation-play-state","paused");var a=$("#player").position().top+$("#player").width(),b=$("#flight-area").height(),c=Math.max(0,b-a);$("#player").transition({y:c+"px",rotate:90},1e3,"easeInOutCubic"),currentState=states.gameEnd,clearInterval(gameLoop),clearInterval(obstacleLoop),gameLoop=null,obstacleLoop=null,isIncompatible.any()?showScore():soundHit.play().bindOnce("ended",function(){soundDie.play().bindOnce("ended",function(){showScore()})})}function showScore(){$("#scoreboard").css("display","block"),setScoreInGame(!0),score>bestScore&&(bestScore=score,setCookie("bestScore",bestScore,999)),setCurrentScore(),setBestScore(),soundSwoosh.stop(),soundSwoosh.play(),$("#scoreboard").css({y:"40px",opacity:0}),$("#restart").css({y:"40px",opacity:0}),$("#scoreboard").transition({y:"0px",opacity:1},500,"ease",function(){soundSwoosh.stop(),soundSwoosh.play(),$("#restart").transition({y:"0px",opacity:1},500,"ease"),setMedal()&&($("#medal").css({scale:2,opacity:0}),$("#medal").transition({opacity:1,scale:1},1200,"ease"))}),restart=!0}function showSplashScreen(){currentState=states.splashScreen,velocity=0,position=180,rotation=0,score=0,updatePlayer($("#player").css({y:0,x:0})),soundSwoosh.stop(),soundSwoosh.play(),$(".obstacle").remove(),obstacle=new Array,$(".animated").css("-webkit-animation-play-state","running"),$(".animated").css("-moz-animation-play-state","running"),$(".animated").css("-o-animation-play-state","running"),$(".animated").css("animation-play-state","running"),$("#splash-screen").transition({opacity:1},2e3,"ease")}function updatePlayer(a){rotation=Math.min(velocity/10*90,90),$(a).css({rotate:rotation,top:position})}function updateScore(){score+=1,soundScore.stop(),soundScore.play(),setScoreInGame()}function addObstacle(){$(".obstacle").filter(function(){return $(this).position().left<=-100}).remove();var a=80,b=420-obstacleHeight-2*a,c=Math.floor(Math.random()*b+a),d=420-obstacleHeight-c,e=$('<div class="obstacle animated"><div class="obstacle_upper" style="height: '+c+'px;"></div><div class="obstacle_lower" style="height: '+d+'px;"></div></div>');$("#flight-area").append(e),obstacle.push(e)}function setScoreInGame(a){var b=$("#score");if(b.empty(),!a)for(var c=score.toString().split(""),d=0;d<c.length;d++)b.append("<img src='assets/fonts/big_"+c[d]+".png' alt='"+c[d]+"'>")}function setCurrentScore(){var a=$("#current-score");a.empty();for(var b=score.toString().split(""),c=0;c<b.length;c++)a.append("<img src='assets/fonts/small_"+b[c]+".png' alt='"+b[c]+"'>")}function setBestScore(){var a=$("#best-score");a.empty();for(var b=bestScore.toString().split(""),c=0;c<b.length;c++)a.append("<img src='assets/fonts/small_"+b[c]+".png' alt='"+b[c]+"'>")}function setMedal(){var a=$("#medal");if(a.empty(),score<10)return!1;if(score>=10)var b="bronze";if(score>=20)var b="silver";if(score>=30)var b="gold";if(score>=40)var b="platinum";return a.append('<img src="assets/scenery/medal_'+b+'.png" alt="'+b+'">'),!0}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""}function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toGMTString();document.cookie=a+"="+b+"; "+e}var debugMode=!1,states=Object.freeze({splashScreen:0,duringGame:1,gameEnd:2}),currentState,gravity=.25,velocity=0,position=180,rotation=0,jump=-4.6,obstacle=new Array,obstacleWidth=52,obstacleHeight=90,score=0,bestScore=0,gameLoop,obstacleLoop,restart=!1,soundJump=new buzz.sound("assets/sounds/wing.ogg"),soundScore=new buzz.sound("assets/sounds/point.ogg"),soundHit=new buzz.sound("assets/sounds/hit.ogg"),soundDie=new buzz.sound("assets/sounds/die.ogg"),soundSwoosh=new buzz.sound("assets/sounds/swooshing.ogg");buzz.all().setVolume(30),$(document).ready(function(){"?debug"==window.location.search?debugMode=!0:"?easy"==window.location.search&&(obstacleHeight=200);var a=getCookie("bestScore");""!=a&&(bestScore=parseInt(a)),showSplashScreen()}),$(document).keydown(function(a){32==a.keyCode&&(currentState==states.gameEnd?$("#restart").click():stateGame())}),"ontouchstart"in window?$(document).on("touchstart",stateGame):$("#modal").on("mousedown",stateGame),$("#restart").click(function(){restart&&(restart=!1,soundSwoosh.stop(),soundSwoosh.play(),$("#scoreboard").transition({y:"-40px",opacity:0},1e3,"ease",function(){$("#scoreboard").css("display","none"),showSplashScreen()}))});var isIncompatible={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Safari:function(){return navigator.userAgent.match(/OS X.*Safari/)&&!navigator.userAgent.match(/Chrome/)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isIncompatible.Android()||isIncompatible.BlackBerry()||isIncompatible.iOS()||isIncompatible.Opera()||isIncompatible.Safari()||isIncompatible.Windows()}};